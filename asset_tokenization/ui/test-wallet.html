<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–æ—à–µ–ª—å–∫–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }

        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        button {
            background: #10b981;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #059669;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
        }

        .error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
        }

        .info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
        }
    </style>
</head>

<body>
    <h1>üîß –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–æ—à–µ–ª—å–∫–æ–≤</h1>

    <div class="test-section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–æ—à–µ–ª—å–∫–æ–≤</h2>
        <div id="walletStatus"></div>
        <button onclick="checkWallets()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—à–µ–ª—å–∫–∏</button>
    </div>

    <div class="test-section">
        <h2>2. –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Phantom</h2>
        <div id="phantomStatus"></div>
        <button onclick="testPhantom()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å Phantom</button>
        <button onclick="forcePhantom()">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ Phantom</button>
    </div>

    <div class="test-section">
        <h2>3. –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è MetaMask</h2>
        <div id="metamaskStatus"></div>
        <button onclick="testMetaMask()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å MetaMask</button>
        <button onclick="forceMetaMask()">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ MetaMask</button>
    </div>

    <div class="test-section">
        <h2>4. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–º –∫–æ—à–µ–ª—å–∫–µ</h2>
        <div id="walletInfo"></div>
        <button onclick="getWalletInfo()">–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
        <button onclick="disconnectWallet()">–û—Ç–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</button>
    </div>

    <div class="test-section">
        <h2>5. –õ–æ–≥–∏ –∫–æ–Ω—Å–æ–ª–∏</h2>
        <div id="consoleLogs"
            style="background: #000; padding: 10px; border-radius: 5px; font-family: monospace; max-height: 200px; overflow-y: auto;">
        </div>
        <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
    </div>

    <script src="solana-wallet-fixed.js"></script>
    <script>
        let logContainer = document.getElementById('consoleLogs');

        // Override console.log to show in UI
        const originalLog = console.log;
        console.log = function (...args) {
            originalLog.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.textContent = args.join(' ');
            logEntry.style.color = '#10b981';
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        };

        const originalError = console.error;
        console.error = function (...args) {
            originalError.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.textContent = args.join(' ');
            logEntry.style.color = '#ef4444';
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        };

        function addStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function checkWallets() {
            console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–æ—à–µ–ª—å–∫–æ–≤...');

            const phantomAvailable = window.solanaWalletManager.isWalletAvailable('phantom');
            const metamaskAvailable = window.solanaWalletManager.isWalletAvailable('metamask');

            let status = '';
            status += `Phantom: ${phantomAvailable ? '‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}<br>`;
            status += `MetaMask: ${metamaskAvailable ? '‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}<br>`;
            status += `window.solana: ${window.solana ? '‚úÖ –ï—Å—Ç—å' : '‚ùå –ù–µ—Ç'}<br>`;
            status += `window.ethereum: ${window.ethereum ? '‚úÖ –ï—Å—Ç—å' : '‚ùå –ù–µ—Ç'}<br>`;

            if (window.solana) {
                status += `window.solana.isPhantom: ${window.solana.isPhantom ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}<br>`;
            }
            if (window.ethereum) {
                status += `window.ethereum.isMetaMask: ${window.ethereum.isMetaMask ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}<br>`;
            }

            addStatus('walletStatus', status, 'info');
        }

        async function testPhantom() {
            try {
                addStatus('phantomStatus', 'üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Phantom...', 'info');
                const result = await window.solanaWalletManager.connect('phantom');
                addStatus('phantomStatus', `‚úÖ Phantom –ø–æ–¥–∫–ª—é—á–µ–Ω!<br>–ê–¥—Ä–µ—Å: ${result.address}`, 'success');
            } catch (error) {
                addStatus('phantomStatus', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        async function testMetaMask() {
            try {
                addStatus('metamaskStatus', 'üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MetaMask...', 'info');
                const result = await window.solanaWalletManager.connect('metamask');
                addStatus('metamaskStatus', `‚úÖ MetaMask –ø–æ–¥–∫–ª—é—á–µ–Ω!<br>–ê–¥—Ä–µ—Å: ${result.address}`, 'success');
            } catch (error) {
                addStatus('metamaskStatus', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        async function forcePhantom() {
            try {
                addStatus('phantomStatus', 'üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Phantom...', 'info');
                const result = await window.solanaWalletManager.forceConnect('phantom');
                addStatus('phantomStatus', `‚úÖ Phantom –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω!<br>–ê–¥—Ä–µ—Å: ${result.address}`, 'success');
            } catch (error) {
                addStatus('phantomStatus', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        async function forceMetaMask() {
            try {
                addStatus('metamaskStatus', 'üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MetaMask...', 'info');
                const result = await window.solanaWalletManager.forceConnect('metamask');
                addStatus('metamaskStatus', `‚úÖ MetaMask –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω!<br>–ê–¥—Ä–µ—Å: ${result.address}`, 'success');
            } catch (error) {
                addStatus('metamaskStatus', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function getWalletInfo() {
            const info = window.solanaWalletManager.getWalletInfo();
            let status = '';
            status += `–ü–æ–¥–∫–ª—é—á–µ–Ω: ${info.isConnected ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}<br>`;
            status += `–ö–æ—à–µ–ª–µ–∫: ${info.wallet || '–ù–µ –≤—ã–±—Ä–∞–Ω'}<br>`;
            status += `–ê–¥—Ä–µ—Å: ${info.address || '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω'}<br>`;
            status += `–ö–æ—Ä–æ—Ç–∫–∏–π –∞–¥—Ä–µ—Å: ${info.shortAddress || '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω'}<br>`;

            addStatus('walletInfo', status, info.isConnected ? 'success' : 'info');
        }

        async function disconnectWallet() {
            try {
                await window.solanaWalletManager.disconnect();
                addStatus('walletInfo', '‚úÖ –ö–æ—à–µ–ª–µ–∫ –æ—Ç–∫–ª—é—á–µ–Ω', 'success');
            } catch (error) {
                addStatus('walletInfo', `‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        function clearLogs() {
            logContainer.innerHTML = '';
        }

        // Auto-check wallets on page load
        window.addEventListener('load', function () {
            setTimeout(() => {
                checkWallets();
                getWalletInfo();
            }, 1000);
        });

        // Listen for wallet changes
        window.addEventListener('walletChanged', function (event) {
            console.log('üîÑ –ö–æ—à–µ–ª–µ–∫ –∏–∑–º–µ–Ω–∏–ª—Å—è:', event.detail);
            getWalletInfo();
        });
    </script>
</body>

</html>