<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Phantom –∫–æ—à–µ–ª—å–∫–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        button {
            background: #10b981;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
            font-weight: bold;
        }
        button:hover {
            background: #059669;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-size: 16px;
        }
        .success { background: rgba(16, 185, 129, 0.2); border: 2px solid #10b981; }
        .error { background: rgba(239, 68, 68, 0.2); border: 2px solid #ef4444; }
        .info { background: rgba(59, 130, 246, 0.2); border: 2px solid #3b82f6; }
        .warning { background: rgba(245, 158, 11, 0.2); border: 2px solid #f59e0b; }
        .log {
            background: #000;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .wallet-info {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üëª –¢–µ—Å—Ç Phantom –∫–æ—à–µ–ª—å–∫–∞</h1>
    
    <div class="test-section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Phantom</h2>
        <div id="phantomCheck"></div>
        <button onclick="checkPhantom()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Phantom</button>
    </div>

    <div class="test-section">
        <h2>2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Phantom</h2>
        <div id="phantomConnect"></div>
        <button onclick="connectPhantom()" id="connectBtn">–ü–æ–¥–∫–ª—é—á–∏—Ç—å Phantom</button>
        <button onclick="disconnectPhantom()" id="disconnectBtn" disabled>–û—Ç–∫–ª—é—á–∏—Ç—å Phantom</button>
    </div>

    <div class="test-section">
        <h2>3. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ—à–µ–ª—å–∫–µ</h2>
        <div id="walletInfo" class="wallet-info"></div>
        <button onclick="getWalletInfo()">–û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
    </div>

    <div class="test-section">
        <h2>4. –õ–æ–≥–∏</h2>
        <div id="logs" class="log"></div>
        <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
    </div>

    <script>
        let logs = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push(logEntry);
            
            const logsDiv = document.getElementById('logs');
            logsDiv.innerHTML = logs.join('<br>');
            logsDiv.scrollTop = logsDiv.scrollHeight;
            
            console.log(logEntry);
        }

        function addStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function checkPhantom() {
            log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Phantom –∫–æ—à–µ–ª—å–∫–∞...');
            
            if (typeof window.solana === 'undefined') {
                addStatus('phantomCheck', '‚ùå window.solana –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Phantom –∫–æ—à–µ–ª–µ–∫!', 'error');
                log('‚ùå window.solana –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            if (!window.solana.isPhantom) {
                addStatus('phantomCheck', '‚ùå Phantom –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Phantom –∫–æ—à–µ–ª–µ–∫!', 'error');
                log('‚ùå window.solana.isPhantom = false');
                return;
            }
            
            addStatus('phantomCheck', '‚úÖ Phantom –æ–±–Ω–∞—Ä—É–∂–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!', 'success');
            log('‚úÖ Phantom –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
            log(`Phantom –≤–µ—Ä—Å–∏—è: ${window.solana.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`);
            log(`Phantom –ø–æ–¥–∫–ª—é—á–µ–Ω: ${window.solana.isConnected || false}`);
        }

        async function connectPhantom() {
            try {
                addStatus('phantomConnect', 'üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Phantom...', 'info');
                log('üîÑ –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Phantom...');
                
                if (!window.solana || !window.solana.isPhantom) {
                    throw new Error('Phantom –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –ª–∏ —É–∂–µ
                if (window.solana.isConnected) {
                    log('‚úÖ Phantom —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
                    addStatus('phantomConnect', '‚úÖ Phantom —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω!', 'success');
                    updateWalletInfo();
                    return;
                }
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                log('üîÑ –ó–∞–ø—Ä–æ—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Phantom...');
                const response = await window.solana.connect();
                
                log('‚úÖ Phantom –ø–æ–¥–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                log(`–ê–¥—Ä–µ—Å: ${response.publicKey.toString()}`);
                
                addStatus('phantomConnect', `‚úÖ Phantom –ø–æ–¥–∫–ª—é—á–µ–Ω!<br>–ê–¥—Ä–µ—Å: ${response.publicKey.toString()}`, 'success');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
                document.getElementById('connectBtn').disabled = true;
                document.getElementById('disconnectBtn').disabled = false;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ—à–µ–ª—å–∫–µ
                updateWalletInfo();
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
                setupPhantomListeners();
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`);
                addStatus('phantomConnect', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        async function disconnectPhantom() {
            try {
                log('üîÑ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç Phantom...');
                
                if (window.solana && window.solana.disconnect) {
                    await window.solana.disconnect();
                }
                
                log('‚úÖ Phantom –æ—Ç–∫–ª—é—á–µ–Ω');
                addStatus('phantomConnect', '‚úÖ Phantom –æ—Ç–∫–ª—é—á–µ–Ω', 'success');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
                document.getElementById('connectBtn').disabled = false;
                document.getElementById('disconnectBtn').disabled = true;
                
                // –û—á–∏—â–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ—à–µ–ª—å–∫–µ
                document.getElementById('walletInfo').innerHTML = '';
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`);
                addStatus('phantomConnect', `‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        function setupPhantomListeners() {
            if (window.solana) {
                window.solana.on('accountChanged', (publicKey) => {
                    log(`üîÑ –ê–∫–∫–∞—É–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω: ${publicKey ? publicKey.toString() : 'null'}`);
                    updateWalletInfo();
                });

                window.solana.on('disconnect', () => {
                    log('üîå Phantom –æ—Ç–∫–ª—é—á–µ–Ω');
                    addStatus('phantomConnect', 'üîå Phantom –æ—Ç–∫–ª—é—á–µ–Ω', 'warning');
                    document.getElementById('connectBtn').disabled = false;
                    document.getElementById('disconnectBtn').disabled = true;
                    document.getElementById('walletInfo').innerHTML = '';
                });
            }
        }

        function updateWalletInfo() {
            if (!window.solana || !window.solana.isConnected) {
                document.getElementById('walletInfo').innerHTML = '<div class="status info">–ö–æ—à–µ–ª–µ–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</div>';
                return;
            }
            
            const publicKey = window.solana.publicKey;
            const address = publicKey.toString();
            const shortAddress = `${address.slice(0, 4)}...${address.slice(-4)}`;
            
            const info = `
                <div class="status success">
                    <strong>‚úÖ Phantom –ø–æ–¥–∫–ª—é—á–µ–Ω</strong><br>
                    <strong>–ê–¥—Ä–µ—Å:</strong> ${address}<br>
                    <strong>–ö–æ—Ä–æ—Ç–∫–∏–π –∞–¥—Ä–µ—Å:</strong> ${shortAddress}<br>
                    <strong>–í–µ—Ä—Å–∏—è:</strong> ${window.solana.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>
                    <strong>–ü–æ–¥–∫–ª—é—á–µ–Ω:</strong> ${window.solana.isConnected ? '–î–∞' : '–ù–µ—Ç'}
                </div>
            `;
            
            document.getElementById('walletInfo').innerHTML = info;
        }

        function getWalletInfo() {
            updateWalletInfo();
        }

        function clearLogs() {
            logs = [];
            document.getElementById('logs').innerHTML = '';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            setTimeout(() => {
                checkPhantom();
                if (window.solana && window.solana.isConnected) {
                    updateWalletInfo();
                    document.getElementById('connectBtn').disabled = true;
                    document.getElementById('disconnectBtn').disabled = false;
                }
            }, 1000);
        });
    </script>
</body>
</html>
