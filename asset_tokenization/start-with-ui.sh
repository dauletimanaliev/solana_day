#!/bin/bash

# ะะะะฃะกะ ะะะะะะะ ะะะะะฃะะขะ ะก ะะะะกะะะซะ UI
# =====================================

echo "๐ ะะะะฃะกะ ะะะะะะะ ะะะะะฃะะขะ ะก ะะะะกะะะซะ UI"
echo "========================================"

# ะัะพะฒะตััะตะผ, ััะพ ะผั ะฒ ะฟัะฐะฒะธะปัะฝะพะน ะดะธัะตะบัะพัะธะธ
if [ ! -f "test-production.js" ]; then
    echo "โ ะัะธะฑะบะฐ: ะะฐะฟัััะธัะต ัะบัะธะฟั ะธะท ะดะธัะตะบัะพัะธะธ asset_tokenization"
    exit 1
fi

echo "โ ะะธัะตะบัะพัะธั ะฝะฐะนะดะตะฝะฐ"

# 1. ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ ะดะปั API
echo "๐ฆ ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ ะดะปั API..."
cd simple-production-backend
if [ ! -d "node_modules" ]; then
    npm install
fi
cd ..

# 2. ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ ะดะปั UI
echo "๐ฆ ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ ะดะปั UI..."
cd ui
if [ ! -d "node_modules" ]; then
    npm install
fi
cd ..

# 3. ะะฐะฟััะบะฐะตะผ API ัะตัะฒะตั
echo "๐ ะะฐะฟััะบะฐะตะผ API ัะตัะฒะตั..."
cd simple-production-backend
node src/index.js &
API_PID=$!
cd ..

# 4. ะะฐะฟััะบะฐะตะผ UI ัะตัะฒะตั
echo "๐จ ะะฐะฟััะบะฐะตะผ UI ัะตัะฒะตั..."
cd ui
node server.js &
UI_PID=$!
cd ..

# ะะดะตะผ ะทะฐะฟััะบะฐ ัะตัะฒะตัะพะฒ
sleep 5

# ะัะพะฒะตััะตะผ, ััะพ ัะตัะฒะตัั ะทะฐะฟัััะธะปะธัั
echo "๐ ะัะพะฒะตััะตะผ ััะฐััั ัะตัะฒะตัะพะฒ..."

# ะัะพะฒะตััะตะผ API
if curl -s http://localhost:3001/health > /dev/null; then
    echo "โ API ัะตัะฒะตั ะทะฐะฟััะตะฝ ะฝะฐ http://localhost:3001"
else
    echo "โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ API ัะตัะฒะตัะฐ"
    exit 1
fi

# ะัะพะฒะตััะตะผ UI
if curl -s http://localhost:3002 > /dev/null; then
    echo "โ UI ัะตัะฒะตั ะทะฐะฟััะตะฝ ะฝะฐ http://localhost:3002"
else
    echo "โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ UI ัะตัะฒะตัะฐ"
    exit 1
fi

echo ""
echo "๐ฏ ะะะะะซะ ะะะะะฃะะข ะก UI ะะะะฃะฉะะ!"
echo "==============================="
echo ""
echo "๐ ะกะะะะะกะซ:"
echo "  ๐ API Server: http://localhost:3001"
echo "  ๐จ UI Server:  http://localhost:3002"
echo "  ๐ Health:     http://localhost:3001/health"
echo ""
echo "๐ ะคะฃะะะฆะะ UI:"
echo "  โ ะกะพะทะดะฐะฝะธะต ะฐะบัะธะฒะพะฒ"
echo "  ๐ช ะะธะฝัะธะฝะณ ัะพะบะตะฝะพะฒ"
echo "  ๐ ะะพะบัะฟะบะฐ ััะฐะบัะธะน"
echo "  ๐ฐ ะะฐัะฟัะตะดะตะปะตะฝะธะต ะดะพัะพะดะฐ"
echo "  ๐ ะะฝะฐะปะธัะธะบะฐ"
echo "  ๐ ะััะพัะธั ััะฐะฝะทะฐะบัะธะน"
echo "  ๐ ะฃะฟัะฐะฒะปะตะฝะธะต ะฐะบัะธะฒะฐะผะธ"
echo ""
echo "๐ ะะขะะะซะขะฌ ะ ะะะะฃะะะะ:"
echo "  UI: http://localhost:3002"
echo "  API: http://localhost:3001"
echo ""
echo "๐ ะะกะขะะะะะะ:"
echo "  ะะฐะถะผะธัะต Ctrl+C ะดะปั ะพััะฐะฝะพะฒะบะธ ะฒัะตั ัะตัะฒะตัะพะฒ"
echo "  ะะปะธ ะฒัะฟะพะปะฝะธัะต: kill $API_PID $UI_PID"
echo ""

# ะัะบััะฒะฐะตะผ ะฑัะฐัะทะตั
echo "๐ ะัะบััะฒะฐะตะผ ะฑัะฐัะทะตั ั UI..."
open http://localhost:3002

echo ""
echo "๐ ะะะะะซะ ะะะะะฃะะข ะก UI ะะะขะะ!"
echo "============================="
echo "API ัะตัะฒะตั ัะฐะฑะพัะฐะตั ะฒ ัะพะฝะต (PID: $API_PID)"
echo "UI ัะตัะฒะตั ัะฐะฑะพัะฐะตั ะฒ ัะพะฝะต (PID: $UI_PID)"
echo ""
echo "ะะปั ะพััะฐะฝะพะฒะบะธ ะฒัะตั ัะตัะฒะตัะพะฒ:"
echo "kill $API_PID $UI_PID"
